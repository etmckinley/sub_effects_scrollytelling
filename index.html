<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eliot McKinley">

<title>Stoppage time matters: how substitutions and using all minutes played affect player statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="index_files/libs/quarto-contrib/intersection-observer-polyfill-1.0.0/intersection-observer.js"></script>
<script src="index_files/libs/quarto-contrib/scrollama-3.2.0/scrollama.min.js"></script>
<script src="index_files/libs/quarto-contrib/closeread-0.1.0/closeread.js"></script>
<meta cr-debug-mode="false">
<meta cr-remove-header-space="false">


<link rel="stylesheet" href="_extensions/qmd-lab/closeread/closeread.css">
<link rel="stylesheet" href="msaz.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content page-columns page-full column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stoppage time matters: how substitutions and using all minutes played affect player statistics</h1>
</div>



<div class="quarto-title-meta column-body">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eliot McKinley </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="section" class="level3 page-columns page-full">
<h3 class="page-columns page-full anchored"></h3>
<div class="column-screen" style="background-image:url(https://raw.githubusercontent.com/etmckinley/goals_added_wheels/refs/heads/main/late_sub.jpg); background-size: cover; height: 70vh; clip-path: inset(0px 0px 0px 0px);">

</div>
<figcaption>
Philadelphia Union’s Tai Baribo replaces Damion Lowe in the 105th minute of expanded game time on May 11, 2024.
</figcaption>
<p><br>
</p>
<p>You might think that determining how much playing time a player receives would be rather straightforward, but it is not.</p>
<p>In soccer statistics there are two camps regarding how to determine how much time a player has spent playing. The first camp ignores stoppage time and <span style="color:#ff5a00"><strong>caps</strong></span> each half at 45 mins for a total of 90 minutes played. The second camp instead decides that stoppage time is still part of the game and <span style="color:#007bdd"><strong>expands</strong></span> the minutes played to include that, too.</p>
<p>The 90 minute absolutists are dominant on most sites you’ll find data such as FBRef, TransferMarkt, Whoscored, or MLSsoccer.com. The argument here is that a soccer game is 90 minutes and any stoppage time in regular time will be exactly accounted for by the ref as added time.</p>
<p>The stoppage time matters crowd realizes that this is not actually true and also <a href="https://medium.com/@balders93/how-much-of-sub-effects-is-to-do-with-the-quality-of-our-data-a74808b34722#.dchbclgbp">what about subs</a>? If a player has been <span style="color:#f0be3d"><strong>substituted</strong></span> into the game in the 90th minute should they only get credit for one minute of playing time even though there is more time played?</p>
<p>American Soccer Analysis has long been part of the stoppage time matters movement. This is why you will see that the minutes played per player you find on the interactive tables is always higher than what you will see at other data sources. Additionally, you will always see stats normalized to the <span style="color:#007bdd"><strong>expanded</strong> <em>per 96 minute</em></span> basis, assuming that games will, on average, have 6 minutes of stoppage time in the first and second halves.</p>
<p>There are many differences that can arise from using one way or the other to count minutes played and substitution effects. These have been chronicled multiple times, most recently by <a href="https://www.expectinggoals.com/p/substitute-effects-study-part-i">Michael Caley</a>, but there is still ground to be covered exploring this further.</p>
<div class="cr-section overlay-center page-columns page-full">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-games_plot">
<div class="narrative">
<p>Each dot is a single MLS regular season game</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="55%,-35%" data-focus-on="cr-games_plot">
<div class="narrative">
<p>From 2013-2017, the average game was 97 minutes long</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-games_plot">
<div class="narrative">
<p>VAR was implemented halfway through the 2017 season</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1.5" data-pan-to="-35%,-35%" data-focus-on="cr-games_plot">
<div class="narrative">
<p>Since the first full season with VAR in 2018, games are getting progressively longer</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-games_plot">
<div class="narrative">
<p>Between 2013 and 2022 there were 2 games that were at least 110 minutes long</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-games_plot">
<div class="narrative">
<p>In 2023 and 2024 there were 23 games that were at least 110 minutes long</p>
</div>
</div>
</div>
<div class="sticky-col page-columns page-full">
<div class="sticky-col-stack page-columns page-full">
<div id="cr-games_plot" class="sticky page-columns page-full">
<section id="mls-games-are-getting-longer" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="mls-games-are-getting-longer">MLS games are getting longer</h2>
<p>Back in the mists of history, it was determined that an average soccer game was 96 minutes long including stoppage. However, that has changed over time in MLS, especially recently.</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div class="page-columns page-full">
<figure class="figure page-columns page-full">
<p class="page-columns page-full"><img src="index_files/figure-html/games_plot-1.svg" class="img-fluid figure-img column-screen"></p>
</figure>
</div>
</div>
</div>
</section>
</div>
</div>
</div>
</div>
</section>
<section id="the-gap-between-capped-and-expanded-minutes-is-increasing" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="the-gap-between-capped-and-expanded-minutes-is-increasing">The gap between capped and expanded minutes is increasing</h2>
<div class="cr-section column-screen sidebar-left">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-total_mins">
<div class="narrative">
<p>In 2013-2017, before the introduction of VAR, the difference between <span style="color:#ff5a00"><strong>capped minutes</strong></span> and<br><span style="color:#007bdd"><strong>expanded minutes</strong></span> was around <strong>8%</strong></p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-total_mins">
<div class="narrative">
<p>Aside from the 2020 COVID-19 shortened season, the total minutes played in a season in MLS increased largely because the league added 10 teams between 2013 and 2024.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-total_mins">
<div class="narrative">
<p>The first few years after VAR was introduced in 2018 saw the difference between <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span> grow to around <strong>10%</strong>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-total_mins">
<div class="narrative">
<p>After the number of allowed substitutions increased to 5 from 3 following the COVID-19 pandemic, the difference grew even more, reaching over <strong>13%</strong> in the 2024 MLS season.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-total_mins" class="sticky">
<p><img src="index_files/figure-html/total_mins-1.svg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</section>
<section id="substitutes-show-the-largest-difference-between-capped-minutes-and-expanded-minutes" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="substitutes-show-the-largest-difference-between-capped-minutes-and-expanded-minutes">Substitutes show the largest difference between capped minutes and expanded minutes</h2>
<p>As you might expect since expanded minutes come from stoppage time, <span style="color:#f0be3d"><strong>substitutes</strong></span> are more affected than <span style="color:#04a3bd"><strong>starters</strong></span> by the use of <span style="color:#ff5a00"><strong>capped minutes</strong></span> rather than <span style="color:#007bdd"><strong>expanded minutes</strong></span>.</p>
<p>With increased game lengths, the difference between <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span> for <span style="color:#04a3bd"><strong>starters</strong></span> remains relatively modest, reaching just over 10% for the first time in 2024. However, for <span style="color:#f0be3d"><strong>substitutes</strong></span>, using <span style="color:#007bdd"><strong>expanded minutes</strong></span> resulted in around a 25% increase in minutes played prior to the introduction of VAR. This has increased to around 35% by 2024.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>At an individual player level, the higher percentage of minutes that are played as a <span style="color:#f0be3d"><strong>substitute</strong></span> correlate with a larger difference between <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span>. For players with a minimum of 200 minutes played, this difference can reach almost 50%.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>While they should generally be ignored, players with fewer than 200 minutes played in a season can have some staggering differences between <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span>. FC Dallas’s <a href="https://www.mlssoccer.com/players/anthony-ramirez/">Anthony Ramirez</a> made one appearance at the end of regular time on July 20, 2024 and was credited with 1 <span style="color:#ff5a00"><strong>capped minute</strong></span>. However, 13 minutes of second half stoppage time were played leading to a 1,200% difference in <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span>.</p>
<div class="cr-section column-screen sidebar-right">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-table">
<div class="narrative">
<p>In practice, though, we don’t really care all that much about players that only make a handful of appearances in a season (except maybe wunderkind Cavan Sullivan with his 9 <span style="color:#ff5a00"><strong>capped minutes</strong></span> and 19 <span style="color:#007bdd"><strong>expanded minutes</strong></span>). Setting a minimum of 500 minutes played that is potentially enough time to start making some non-confident assessments of players, these are the top ten players by difference between <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-table">
<div class="narrative">
<p>All 10 of the players with the largest differences between <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span> have come in the 2022, 2023, and 2024 seasons.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-table">
<div class="narrative">
<p>The common theme among these players is that they are largely attacking players that make the majority of their appearances and minutes as a <span style="color:#f0be3d"><strong>substitute</strong></span>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-table">
<div class="narrative">
<p>Topping the list is g+ favorite, Danny Musovski, who put up a 95th percentile g+ season in 2021 for LAFC. The Seattle forward had a 30% difference in <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span> in 2024 while making 20 of his 24 appearances as a <span style="color:#f0be3d"><strong>substitute</strong></span>.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-table" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div id="qpaslsxawi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Saira+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#qpaslsxawi table {
  font-family: 'Saira Condensed', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qpaslsxawi thead, #qpaslsxawi tbody, #qpaslsxawi tfoot, #qpaslsxawi tr, #qpaslsxawi td, #qpaslsxawi th {
  border-style: none;
}

#qpaslsxawi p {
  margin: 0;
  padding: 0;
}

#qpaslsxawi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #15202B;
  font-size: 14px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qpaslsxawi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qpaslsxawi .gt_title {
  color: #15202B;
  font-size: 20px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qpaslsxawi .gt_subtitle {
  color: #15202B;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qpaslsxawi .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qpaslsxawi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qpaslsxawi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qpaslsxawi .gt_col_heading {
  color: #15202B;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qpaslsxawi .gt_column_spanner_outer {
  color: #15202B;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qpaslsxawi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qpaslsxawi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qpaslsxawi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qpaslsxawi .gt_spanner_row {
  border-bottom-style: hidden;
}

#qpaslsxawi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #15202B;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qpaslsxawi .gt_empty_group_heading {
  padding: 0.5px;
  color: #15202B;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qpaslsxawi .gt_from_md > :first-child {
  margin-top: 0;
}

#qpaslsxawi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qpaslsxawi .gt_row {
  padding-top: 3px;
  padding-bottom: 3px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6FDFE;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qpaslsxawi .gt_stub {
  color: #15202B;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qpaslsxawi .gt_stub_row_group {
  color: #15202B;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qpaslsxawi .gt_row_group_first td {
  border-top-width: 2px;
}

#qpaslsxawi .gt_row_group_first th {
  border-top-width: 2px;
}

#qpaslsxawi .gt_summary_row {
  color: #15202B;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qpaslsxawi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qpaslsxawi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qpaslsxawi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qpaslsxawi .gt_grand_summary_row {
  color: #15202B;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qpaslsxawi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qpaslsxawi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qpaslsxawi .gt_striped {
  background-color: #F8FBFC;
}

#qpaslsxawi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qpaslsxawi .gt_footnotes {
  color: #15202B;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qpaslsxawi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qpaslsxawi .gt_sourcenotes {
  color: #15202B;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qpaslsxawi .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qpaslsxawi .gt_left {
  text-align: left;
}

#qpaslsxawi .gt_center {
  text-align: center;
}

#qpaslsxawi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qpaslsxawi .gt_font_normal {
  font-weight: normal;
}

#qpaslsxawi .gt_font_bold {
  font-weight: bold;
}

#qpaslsxawi .gt_font_italic {
  font-style: italic;
}

#qpaslsxawi .gt_super {
  font-size: 65%;
}

#qpaslsxawi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qpaslsxawi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qpaslsxawi .gt_indent_1 {
  text-indent: 5px;
}

#qpaslsxawi .gt_indent_2 {
  text-indent: 10px;
}

#qpaslsxawi .gt_indent_3 {
  text-indent: 15px;
}

#qpaslsxawi .gt_indent_4 {
  text-indent: 20px;
}

#qpaslsxawi .gt_indent_5 {
  text-indent: 25px;
}

#qpaslsxawi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qpaslsxawi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header gt_heading">
<th colspan="10" class="gt_heading gt_title gt_font_normal">Top 10 largest differences in <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span></th>
</tr>
<tr class="odd gt_heading">
<th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">MLS 2013-2024, minimum 500 minutes played</th>
</tr>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="head_shot" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"></th>
<th rowspan="2" id="player_name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th rowspan="2" id="season_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Season</th>
<th colspan="3" id="Appearances" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Appearances
</div></th>
<th colspan="4" id="Minutes" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Minutes
</div></th>
</tr>
<tr class="odd gt_col_headings">
<th id="games" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Total</th>
<th id="starts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col"><span style="color:#04a3bd">Start</span></th>
<th id="subs" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col"><span style="color:#f0be3d">Sub</span></th>
<th id="total_mins" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col"><span style="color:#ff5a00">Capped</span></th>
<th id="total_expanded_mins" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col"><span style="color:#007bdd">Expanded</span></th>
<th id="perc_sub" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col"><span style="color:#f0be3d">as Sub</span></th>
<th id="perc_diff" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Difference</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/0Oq6ENn256.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left" headers="player_name">Danny Musovski</td>
<td class="gt_row gt_right" headers="season_id">2024</td>
<td class="gt_row gt_right" headers="games">24</td>
<td class="gt_row gt_right" headers="starts">4</td>
<td class="gt_row gt_right" headers="subs">20</td>
<td class="gt_row gt_right" headers="total_mins">503</td>
<td class="gt_row gt_right" headers="total_expanded_mins">656</td>
<td class="gt_row gt_right" headers="perc_sub">57%</td>
<td class="gt_row gt_right" headers="perc_diff">30%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/kRQaor8O5K.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left gt_striped" headers="player_name">Georgios Koutsias</td>
<td class="gt_row gt_right gt_striped" headers="season_id">2024</td>
<td class="gt_row gt_right gt_striped" headers="games">29</td>
<td class="gt_row gt_right gt_striped" headers="starts">5</td>
<td class="gt_row gt_right gt_striped" headers="subs">24</td>
<td class="gt_row gt_right gt_striped" headers="total_mins">771</td>
<td class="gt_row gt_right gt_striped" headers="total_expanded_mins">994</td>
<td class="gt_row gt_right gt_striped" headers="perc_sub">55%</td>
<td class="gt_row gt_right gt_striped" headers="perc_diff">29%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/eVq3jBjj5W.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left" headers="player_name">Tom Barlow</td>
<td class="gt_row gt_right" headers="season_id">2024</td>
<td class="gt_row gt_right" headers="games">28</td>
<td class="gt_row gt_right" headers="starts">5</td>
<td class="gt_row gt_right" headers="subs">23</td>
<td class="gt_row gt_right" headers="total_mins">733</td>
<td class="gt_row gt_right" headers="total_expanded_mins">941</td>
<td class="gt_row gt_right" headers="perc_sub">53%</td>
<td class="gt_row gt_right" headers="perc_diff">28%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/0x5gJEVLM7.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left gt_striped" headers="player_name">Jacob Murrell</td>
<td class="gt_row gt_right gt_striped" headers="season_id">2024</td>
<td class="gt_row gt_right gt_striped" headers="games">27</td>
<td class="gt_row gt_right gt_striped" headers="starts">6</td>
<td class="gt_row gt_right gt_striped" headers="subs">21</td>
<td class="gt_row gt_right gt_striped" headers="total_mins">867</td>
<td class="gt_row gt_right gt_striped" headers="total_expanded_mins">1113</td>
<td class="gt_row gt_right gt_striped" headers="perc_sub">48%</td>
<td class="gt_row gt_right gt_striped" headers="perc_diff">28%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/BLMv7DLA5x.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left" headers="player_name">Darren Yapi</td>
<td class="gt_row gt_right" headers="season_id">2024</td>
<td class="gt_row gt_right" headers="games">30</td>
<td class="gt_row gt_right" headers="starts">5</td>
<td class="gt_row gt_right" headers="subs">25</td>
<td class="gt_row gt_right" headers="total_mins">727</td>
<td class="gt_row gt_right" headers="total_expanded_mins">929</td>
<td class="gt_row gt_right" headers="perc_sub">51%</td>
<td class="gt_row gt_right" headers="perc_diff">28%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/KAqB9Vgm5b.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left gt_striped" headers="player_name">Tesho Akindele</td>
<td class="gt_row gt_right gt_striped" headers="season_id">2022</td>
<td class="gt_row gt_right gt_striped" headers="games">27</td>
<td class="gt_row gt_right gt_striped" headers="starts">4</td>
<td class="gt_row gt_right gt_striped" headers="subs">23</td>
<td class="gt_row gt_right gt_striped" headers="total_mins">589</td>
<td class="gt_row gt_right gt_striped" headers="total_expanded_mins">749</td>
<td class="gt_row gt_right gt_striped" headers="perc_sub">58%</td>
<td class="gt_row gt_right gt_striped" headers="perc_diff">27%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/zeQZjOPjQK.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left" headers="player_name">Daniel Aguirre</td>
<td class="gt_row gt_right" headers="season_id">2023</td>
<td class="gt_row gt_right" headers="games">25</td>
<td class="gt_row gt_right" headers="starts">3</td>
<td class="gt_row gt_right" headers="subs">22</td>
<td class="gt_row gt_right" headers="total_mins">556</td>
<td class="gt_row gt_right" headers="total_expanded_mins">707</td>
<td class="gt_row gt_right" headers="perc_sub">59%</td>
<td class="gt_row gt_right" headers="perc_diff">27%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/Vj58lyym58.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left gt_striped" headers="player_name">Emerson Rodríguez</td>
<td class="gt_row gt_right gt_striped" headers="season_id">2022</td>
<td class="gt_row gt_right gt_striped" headers="games">22</td>
<td class="gt_row gt_right gt_striped" headers="starts">1</td>
<td class="gt_row gt_right gt_striped" headers="subs">21</td>
<td class="gt_row gt_right gt_striped" headers="total_mins">509</td>
<td class="gt_row gt_right gt_striped" headers="total_expanded_mins">642</td>
<td class="gt_row gt_right gt_striped" headers="perc_sub">88%</td>
<td class="gt_row gt_right gt_striped" headers="perc_diff">26%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/gjMNvZdBMK.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left" headers="player_name">Yamil Asad</td>
<td class="gt_row gt_right" headers="season_id">2023</td>
<td class="gt_row gt_right" headers="games">21</td>
<td class="gt_row gt_right" headers="starts">5</td>
<td class="gt_row gt_right" headers="subs">16</td>
<td class="gt_row gt_right" headers="total_mins">514</td>
<td class="gt_row gt_right" headers="total_expanded_mins">648</td>
<td class="gt_row gt_right" headers="perc_sub">36%</td>
<td class="gt_row gt_right" headers="perc_diff">26%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="head_shot"><img src="https://american-soccer-analysis-headshots.s3.amazonaws.com/player_headshots/KXMe8YjPQ6.png" class="img-fluid" style="height:30px;"></td>
<td class="gt_row gt_left gt_striped" headers="player_name">Edwin Mosquera</td>
<td class="gt_row gt_right gt_striped" headers="season_id">2024</td>
<td class="gt_row gt_right gt_striped" headers="games">22</td>
<td class="gt_row gt_right gt_striped" headers="starts">5</td>
<td class="gt_row gt_right gt_striped" headers="subs">17</td>
<td class="gt_row gt_right gt_striped" headers="total_mins">614</td>
<td class="gt_row gt_right gt_striped" headers="total_expanded_mins">771</td>
<td class="gt_row gt_right gt_striped" headers="perc_sub">55%</td>
<td class="gt_row gt_right gt_striped" headers="perc_diff">26%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="substitutes-minutes-normalized-stats-are-better-than-starters" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="substitutes-minutes-normalized-stats-are-better-than-starters">Substitutes’ minutes-normalized stats are better than starters</h2>
<p>OK, so <span style="color:#f0be3d"><strong>substitutes</strong></span> show the largest difference between <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span>, but so what? We don’t really care about minutes played on its own.</p>
<p>What really matters is what players do in the minutes they play. Across almost every offensive statistical measure, <span style="color:#f0be3d"><strong>substitutes</strong></span> have higher per minute metrics than <span style="color:#04a3bd"><strong>starters</strong></span>. This has been very well documented by <a href="https://www.expectinggoals.com/p/substitute-effects-study-part-i">Michael Caley</a> for many stats, so for simplicity we will just focus on goals and expected goals.</p>
<p>For normalization we will use three different methods:</p>
<ul>
<li><p><span style="color:#ff5a00"><em>per 90’</em></span> : <span style="color:#ff5a00"><strong>capped minutes</strong></span> normalized to 90 minutes per game</p></li>
<li><p><span style="color:#007bdd"><em>per 96’</em></span> : <span style="color:#007bdd"><strong>expanded minutes</strong></span> normalized to 96 minutes per game</p></li>
<li><p><em>per season’</em> : <span style="color:#007bdd"><strong>expanded minutes</strong></span> normalized to the average game length for each season to account for increasing game lengths in recent years</p></li>
</ul>
<div class="cr-section column-screen overlay-center">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-subs_performance">
<div class="narrative">
<p>Each small dot is the value for a metric for all <span style="color:#04a3bd"><strong>starters</strong></span> and <span style="color:#f0be3d"><strong>substitutes</strong></span> in a season</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-subs_performance">
<div class="narrative">
<p>The large dot for each metric is the average over all seasons with the line as the bootstrapped 95% confidence interval </p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-subs_performance">
<div class="narrative">
<p>No matter the minutes normalization method, <span style="color:#f0be3d"><strong>substitutes</strong></span> have higher values than <span style="color:#04a3bd"><strong>starters</strong></span></p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-subs_performance">
<div class="narrative">
<p>There is little difference between normalization methods for <span style="color:#04a3bd"><strong>starters</strong></span></p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-subs_performance">
<div class="narrative">
<p>Normalization with either method that uses <span style="color:#007bdd"><strong>expanded minutes</strong></span> decreases the difference between <span style="color:#f0be3d"><strong>substitutes</strong></span> and <span style="color:#04a3bd"><strong>starters</strong></span></p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1.3" data-pan-to="-35%,-10%" data-focus-on="cr-subs_performance">
<div class="narrative">
<p>There is little difference between <span style="color:#007bdd"><em>per 96’</em></span> and <em>per season’</em> normalization methods</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-subs_performance">
<div class="narrative">
<p>Note: <span style="color:#f0be3d"><strong>substitutes</strong></span> do not “finish” better (i.e.&nbsp;goals &gt; xG) than <span style="color:#04a3bd"><strong>starters</strong></span> as has been seen by others using European data</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-subs_performance" class="sticky">
<p><img src="index_files/figure-html/subs-performance-1.svg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
<p>Even though game times have been increasing, there was little difference between the <span style="color:#007bdd"><em>per 96’</em></span> and <em>per season’</em> normalization methods, going forward we’ll only use the <span style="color:#007bdd"><em>per 96’</em></span> method. Perhaps if game times get much longer, then this will have to be reevaluated.</p>
</section>
<section id="per-96-normalization-removes-the-difference-between-starters-and-substitutes-metrics-for-primarily-offensive-players" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="per-96-normalization-removes-the-difference-between-starters-and-substitutes-metrics-for-primarily-offensive-players"><span style="color:#007bdd"><em>per 96’</em></span> normalization removes the difference between starters’ and substitutes’ metrics for primarily offensive players</h2>
<p>Overall, <span style="color:#f0be3d"><strong>substitutes</strong></span> have higher per-minute metrics than <span style="color:#04a3bd"><strong>starters</strong></span>, but this difference is not evenly distributed among positions.</p>
<div class="cr-section overlay-center page-columns page-full">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-pos_xg">
<div class="narrative">
<p>Each small dot is the value for a metric for all <span style="color:#04a3bd"><strong>starters</strong></span> and <span style="color:#f0be3d"><strong>substitutes</strong></span> in a season for each position</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_xg">
<div class="narrative">
<p>The large dot for each metric is the average over all seasons with the line as the bootstrapped 95% confidence interval for each position </p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_xg">
<div class="narrative">
<p>Asterisks indicate whether there is a statistically significant difference between <span style="color:#04a3bd"><strong>starters</strong></span> and <span style="color:#f0be3d"><strong>substitutes</strong></span> for each metric</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1.2" data-pan-to="35%, 0%" data-focus-on="cr-pos_xg">
<div class="narrative">
<p>For defensive and central midfield positions, normalizing using a <span style="color:#007bdd"><em>per 96’</em></span> method doesn’t remove the performance boost that <span style="color:#f0be3d"><strong>substitutes</strong></span> get over <span style="color:#04a3bd"><strong>starters</strong></span></p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1.4" data-pan-to="-45%, 0%" data-focus-on="cr-pos_xg">
<div class="narrative">
<p>But for attackers, where <span style="color:#f0be3d"><strong>substitutes</strong></span> have higher stats than <span style="color:#04a3bd"><strong>starters</strong></span> using <span style="color:#ff5a00"><em>per 90’</em></span> normaliztion, that difference disappears when using a <span style="color:#007bdd"><em>per 96’</em></span> method</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1.4" data-pan-to="-45%, 0%" data-focus-on="cr-pos_xg">
<div class="narrative">
<p>Curiously, for attacking midfielders and strikers <span style="color:#f0be3d"><strong>substitutes</strong></span> have lower goals and expected goals on a <span style="color:#007bdd"><em>per 96’</em></span> basis than <span style="color:#04a3bd"><strong>starters</strong></span>, although this is not statistically significant</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_xg">
<div class="narrative">
<p>So the increased production of offensive stats for <span style="color:#f0be3d"><strong>substitutes</strong></span> over <span style="color:#04a3bd"><strong>starters</strong></span> comes from the attacking output of more defensive players.</p>
</div>
</div>
</div>
<div class="sticky-col page-columns page-full">
<div class="sticky-col-stack page-columns page-full">
<div id="cr-pos_xg" class="sticky page-columns page-full">
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div class="page-columns page-full">
<figure class="figure page-columns page-full">
<p class="page-columns page-full"><img src="index_files/figure-html/unnamed-chunk-4-1.svg" class="img-fluid figure-img column-screen"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>To explain this we have to drill just a bit deeper. It’s been known since the <a href="https://thepowerofgoals.blogspot.com/2012/05/scoring-efficiency-and-current-score.html">dawn of analytics</a> that teams that are winning tend to have fewer, but higher quality shots and more goals than teams that are losing. This has been confirmed <a href="https://statsbomb.com/articles/soccer/score-effects/">many</a> <a href="https://statsandsnakeoil.wordpress.com/2015/03/12/visualising-the-championship-good-lucky-matrix-over-time/">times</a> since.</p>
<p>However, almost all of the public work looking at game states and shots was done in European leagues, was limited to a single season or team, and in some cases even predated expected goals. Since <a href="https://www.americansocceranalysis.com/home/2022/7/20/europe-money-and-the-problem-with-disparity">MLS is weird</a>, we’ll look across all the 12 seasons available in the ASA era.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In short, previous reports are confirmed. Teams that are winning take fewer, but higher quality shots than teams that are losing or, to a lesser extend, tied. Additionally, teams in any non-tied game state score more goals than when tied, with teams up 2 or more running up the score even more.</p>
<p>However, for <span style="color:#4682B4">expected goals</span>, losing teams generate more than teams that are tied or up one goal. The main difference between winning and losing team is that losing teams score fewer goals than <span style="color:#4682B4">expected</span>, while winning teams score more. This has been often attributed to more space being available for winning teams to attack into as the losing team has to be more adventurous chasing the game. Of note, the ASA xG model does not have defender positioning to take this into account (although it does have many other factors that can infer it), and other models may not see this discrepancy.</p>
<p>With that taken care of, how does game state affect specific positions? Here we’ll look at how a starter’s xG <span style="color:#ff5a00"><em>per 90’</em></span> or <span style="color:#007bdd"><em>per 96’</em></span> compares to <span style="color:#f0be3d"><strong>substitutes</strong></span> brought into the game at different game states.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As was shown before, defenders have lower goals and xG than attackers. <span style="color:#f0be3d"><strong>Substitute</strong></span> defenders and midfielders also show little difference between <span style="color:#ff5a00"><em>per 90’</em></span> and <span style="color:#007bdd"><em>per 96’</em></span> methods whereas attacking <span style="color:#f0be3d"><strong>substitutes</strong></span> do not get a boost when using <span style="color:#007bdd"><em>per 96’</em></span> accounting.</p>
<p>However, the effects of game state are different between defenders and strikers, with <span style="color:#f0be3d"><strong>substitute</strong></span> defenders contributing the most goals and expected goals when a team is losing compared to <span style="color:#04a3bd"><strong>starters</strong></span>, and <span style="color:#f0be3d"><strong>substitutes</strong></span> strikers doing so when winning. Midfielders are a bit of a jumble.</p>
<p>Let’s take a bit of a closer look at center backs and strikers to illustrate the difference more clearly.</p>
<div class="cr-section column-screen sidebar-left">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-pos_gs_cb">
<div class="narrative">
<p>Given that the role of a center back is primarily defensive, they do not score many goals or generate much xG.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_gs_cb">
<div class="narrative">
<p>When teams are trailing, center backs generate about twice as much xG when subbed on in losing game states and also show an increase in goals scored - both consistent with a team chasing the game by throwing players forward.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_gs_cb">
<div class="narrative">
<p>When center backs are subbed on in winning game states, they score fewer goals and generate fewer expected goals - as you might expect from a team trying to keep a lead.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_gs_cb">
<div class="narrative">
<p>In either case, there is very little difference between <span style="color:#ff5a00"><em>per 90’</em></span> and <span style="color:#007bdd"><em>per 96’</em></span> accounting methods.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-shot_times_cb">
<div class="narrative">
<p>The reason for this is that by far the highest amount of xG generated by center backs is in second half stoppage time. The xG created after 90’ dwarfs that of any other minute played, being over twice as high as the xG created in first half stoppage time for both <span style="color:#04a3bd"><strong>starters</strong></span>, and <span style="color:#f0be3d"><strong>substitutes</strong></span>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-shot_times_cb">
<div class="narrative">
<p>Overall, because of this discrepancy, the <span style="color:#007bdd"><em>per 96’</em></span> accounting breaks down as center backs that are <span style="color:#f0be3d"><strong>substituted</strong></span> on are essentially enriched for high xG parts of the game, swamping any beneficial normalization effect for using <span style="color:#007bdd"><strong>expanded minutes</strong></span>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-shot_times_cb_gs">
<div class="narrative">
<p>When adding in game state, it is clear that we see the enriched xG effect in second half stoppage time when teams are losing, and to a lesser extent when tied. We see a decrease in xG generated in second half stoppage time when teams are winning.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_gs_cb">
<div class="narrative">
<p>This explains why <span style="color:#007bdd"><em>per 96’</em></span> normalization fails to correct for <span style="color:#f0be3d"><strong>substitution</strong></span> effects when teams are losing, which propagates to the overall picture for center backs that we saw earlier.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_gs_st">
<div class="narrative">
<p>Moving on to strikers, we see an opposite trend compared to center backs. Substitute strikers tend to have higher goals and expected goals on a <span style="color:#ff5a00"><em>per 90’</em></span> basis when a team is winning.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_gs_st">
<div class="narrative">
<p>However, when using a <span style="color:#007bdd"><em>per 96’</em></span> normalization method, the difference between <span style="color:#04a3bd"><strong>starters</strong></span> and <span style="color:#f0be3d"><strong>substitutes</strong></span> as well as that of game state largely disappears.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-shot_times_st">
<div class="narrative">
<p>The difference between center backs and strikers is that shooters shoot. Strikers have two large peaks corresponding to both halves of stoppage time, rather than just the one for center backs. As such, there isn’t an asymmetry of attacking stats based upon if a player is on the field in first or second half stoppage time.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-shot_times_st_gs">
<div class="narrative">
<p>Similarly, when you add in game state, starters retain the xG peaks in both stoppage times and it doesn’t dissapear when teams are winning like with center backs.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-pos_gs_st">
<div class="narrative">
<p>This emphasizes that when assessing primarily attacking players, normalizing using a <span style="color:#007bdd"><em>per 96’</em></span> method is crucial to remove substitution effects.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-shot_times">
<div class="narrative">
<p>Bringing this back around for all positions, those that have a larger peak in first half stoppage time than second half stoppage time, i.e.&nbsp;attackers, for <span style="color:#04a3bd"><strong>starters</strong></span> are the positions where <span style="color:#007bdd"><em>per 96’</em></span> normalization is able to correct for substitution effects. For defenders and center midfielders, the increased xG in second half stoppage time is too strong.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-shot_times">
<div class="narrative">
<p>While I haven’t shown other statistics such as shots, key passes, and assists, they show a similar pattern to goals and expected goals.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-pos_gs_cb" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-pos_gs_st" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-shot_times_cb" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-shot_times_cb_gs" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-shot_times_st" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-shot_times_st_gs" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-shot_times" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="ilsinho" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="ilsinho">Ilsinho</h2>
<p>One player sums up the issues with the substitution effect and consequences of using different normalization methods: Philadelphia Union legend Ilsinho.</p>
<p>Never a minute eater, Ilsinho never played more than 1,500 regular season minutes in his decade long career prior to joining Philly.</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div class="page-columns page-full">
<figure class="figure page-columns page-full">
<p class="page-columns page-full"><img src="index_files/figure-html/unnamed-chunk-14-1.svg" class="img-fluid figure-img column-page-left"></p>
</figure>
</div>
</div>
</div>
<p>In his first two seasons with the Union, he was a regular starter when available, however 90% of the time was subbed out prior to second half stoppage time. While this isn’t especially rare for attacking players, it did result in Ilsinho having the rare distinction of having slightly higher <span style="color:#007bdd"><em>per 96’</em></span> stats than <span style="color:#ff5a00"><em>per 90’</em></span> in 2017. His 1,850 regular season minutes were a career high in 2017, but as he rarely made it to second half stoppage time, he never collected the boost that comes with <span style="color:#ff5a00"><strong>capped mintute</strong></span> accounting.</p>
<p>As Ilsinho transitioned into a super sub role starting in 2018 (40% of minutes as a sub) his <span style="color:#007bdd"><em>per 96’</em></span> began to be noticeably below his <span style="color:#ff5a00"><em>per 90’</em></span> stats. This reached it’s final form in 2019 (60% of minutes as a sub) and 2020 (80% of minutes as a sub) where his <span style="color:#ff5a00"><em>per 90’</em></span> and <span style="color:#007bdd"><em>per 96’</em></span> stats diverged by 5% and 11%, respectively. He also scored far more than his xG would predict, cementing his legendary MLS super sub status.</p>
</section>
<section id="the-atalanta-effect-and-tom-barlow" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="the-atalanta-effect-and-tom-barlow">The Atalanta Effect and Tom Barlow</h2>
<p>Building on the work of <a href="https://www.expectinggoals.com/p/substitute-effects-study-part-i">Michael Caley</a>, <a href="https://bsky.app/profile/revenueminuscosts.bsky.social">J. Sam Jones</a> recently wrote about some possible concerns with Aleksei Miranchuk’s signing for Atlanta United being driven by <a href="https://www.fivestripefinal.com/p/substitute-effects-and-the-dangers">substitution effects</a>. In a followup, Jones discovered a phenomenon dubbed the <a href="https://www.fivestripefinal.com/p/worrying-about-miranchuk-pt-2-the">Atalanta Effect</a>, whereby players from Atalanta got a “statistical steroid” by playing for a relentlessly attacking team that was also potentially boosted by substitution effects. A litany of Atalanta players’ stats were shown as being seemingly world beaters while playing in Bergamo, but as mostly average somewhere else.</p>
<p>I’ll more generally define the Atlanta Effect as the inflation of <span style="color:#ff5a00"><em>per 90’</em></span> statistics observed when playing for a team that is generally better or more attacking than average compounded by being used as a substitute. Any club acquiring such players should be wary that attacking output for this player may not continue for your club.</p>
<p>While MLS’ parity prevents players from fully attaining the Atalanta Effect by playing for a far and away better team others in the league, the effect can still be significant for substitutes. All the players shown previously as having large differences in <span style="color:#ff5a00"><strong>capped minutes</strong></span> and <span style="color:#007bdd"><em>expanded minutes</em></span> also show an approximately 20% boost in goals and expected goals using <span style="color:#ff5a00"><em>per 90’</em></span> stats versus <span style="color:#007bdd"><em>per 96’</em></span>.</p>
<div class="cr-section column-screen sidebar-right">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-barlow_only">
<div class="narrative">
<p>For example, in 2024, Tom Barlow’s played 733 <span style="color:#ff5a00"><strong>capped minutes</strong></span> and 941 <span style="color:#007bdd"><em>expanded minutes</em></span> for an objectively bad Chicago Fire team.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-barlow_only">
<div class="narrative">
<p>Barlow appeared in 28 games in 2024, with only 5 starts — 4 of which he was subbed off before the 80th minute, thus missing the second half stoppage time. Overall, 53% of his <span style="color:#007bdd"><em>expanded minutes</em></span> came as a <span style="color:#f0be3d"><strong>substitute</strong></span></p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-barlow_cucho">
<div class="narrative">
<p>Barlow’s <span style="color:#ff5a00"><em>per 90’</em></span> xG is on par with a couple of MVP candidates, Cucho Hernandez and Chicho Arango.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-barlow_ag">
<div class="narrative">
<p>However, his <span style="color:#007bdd"><em>per 96’</em></span> xG was equivalent to Patrick Agyemang or Elias Manoel.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-barlow_all">
<div class="narrative">
<p>Not that having Patrick Agyemang and Elias Manoel as peers - albeit with 1,000 fewer minutes- is bad, but it puts the differences in <span style="color:#ff5a00"><em>per 90’</em></span> and <span style="color:#007bdd"><em>per 96’</em></span> into context.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-barlow_only" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-barlow_cucho" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-barlow_ag" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-barlow_all" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-18-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="cr-barlows" class="sticky">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-19-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>For what it’s worth, the Atalanta Effect hit Miranchuk hard in his first half season in Atlanta. While his attacking stats via FBRef in his <a href="https://fbref.com/en/players/a9aa0d1d/scout/12229/Aleksei-Miranchuk-Scouting-Report">final season with Atalanta</a> were in the 98th percentile, they mostly fell below average in Atlanta. Perhaps Miranchuk is a victim of the first season of the <a href="https://www.mlssoccer.com/news/way-too-early-2022-mls-mvp-candidates-sorted-by-tier">David Gass Theorem</a> (i.e.&nbsp;it takes a year for players to adjust to MLS) - which, by the way, someone should investigate if it actually exists.</p>
</section>
<section id="conclusions" class="level2 page-columns page-full">
<h2 class="page-columns page-full anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>OK, that was a lot of scrollytelling, but what have we learned?</p>
<ul>
<li><p>MLS games are getting longer.</p></li>
<li><p>Longer games have caused the difference between <span style="color:#ff5a00"><strong>capped mintutes</strong></span> and <span style="color:#007bdd"><strong>expanded minutes</strong></span> to grow, especially for <span style="color:#f0be3d"><strong>substitutes</strong></span>.</p></li>
<li><p><span style="color:#f0be3d"><strong>Substitutes</strong></span> have higher per minute stats than <span style="color:#04a3bd"><strong>starters</strong></span> no matter how you count minutes.</p></li>
<li><p><span style="color:#007bdd"><em>Per 96’</em></span> stats correct for substitution effects for attackers, but not other positions. This is due to a combination of game state effects on attacking stats and an even spread of offensive production in first and second half stoppage time for attackers that is not present for other positions.</p></li>
<li><p>When scouting players, you need to be aware of all of these factors and more to not get burned by the Atalanta Effect.</p></li>
</ul>
<p>There is plenty more to be mined from looking at how minutes are counted and substitution effects. For example, I did not consider home advantage, which is larger in MLS than any other league. As with many things in soccer, these results may vary when looking at more unequal leagues such as those in Europe.</p>
<p>Regardless, don’t be fooled by <span style="color:#ff5a00"><em>per 90’</em></span> that are commonly found online, they may not tell the whole story.</p>
<p><br>
</p>
</section>
<section id="info" class="level1">
<h1></h1>
<p>This article was written with <a href="https://quarto.org">Quarto</a>, <a href="https://closeread.netlify.app">closeread</a>, and <a href="https://www.r-project.org">R</a> based off of the work of <a href="https://github.com/mschnetzer/scrollytell_arbeitszeit">Matthias Schnetzer</a></p>
<p><br>
</p>
<p>For more, find me at <a href="https://eliotmckinley.com">eliotmckinley.com</a> and on Bluesky <a href="https://bsky.app/profile/eliotmckinley.com"><span class="citation" data-cites="eliotmckinley.com">@eliotmckinley.com</span></a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>